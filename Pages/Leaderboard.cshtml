@page
@model LeaderboardModel
@{
    ViewData["Title"] = "Leaderboard";
    var levelQuery = Model.CurrentLevel == 0 ? "" : $"&level={Model.CurrentLevel}";
    var levelName = Model.CurrentLevel == 0 ? "Top Score |" : $"Level {Model.CurrentLevel} |";
    var playerQuery = Model.PlayerName is null ? "" : $"&player={Model.PlayerName}";
    var numLevels = 5;


}

<h1>
    Leaderboard – @levelName Page @Model.CurrentPage of @Model.TotalPages</h1>

@if (Model.PlayerName is not null)
{


    @if (Model.PlayerRow is not null)
    {
        <p class="leaderboard-meta">
            Player <strong>@Model.PlayerRow.PlayerName</strong> is ranked <strong>#@Model.PlayerRow.Rank</strong> out of <strong>@Model.TotalPlayers</strong>
        </p>
    }
    else
    {
        <p class="leaderboard-meta">
            Player <strong>@Model.PlayerName</strong> is not ranked yet
        </p>
    }

}

<div style="margin-bottom: 15px;">
    <strong>View:</strong>
    <a href="/Leaderboard?page=0&level=0@(playerQuery)">Total</a>
    <span style="margin-left: 10px;">
        @for (int i = 1; i <= numLevels; i++) 
        {
            <a href="/Leaderboard?page=0&level=@i@playerQuery" style="margin-left: 10px;">Level @i</a>
        }
    </span>
</div>


<table class="table">
    <thead>
        <tr>
            <th>Rank</th>
            <th>Player</th>
            <th>Score</th>
            <th>Last Played</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var entry in Model.Scores)
        {
            if (entry.PlayerName == Model.PlayerName)
            {
                <tr>

                    <td><strong>@entry.Rank</strong></td>
                    <td>
                        <strong>
                        <a href="/Leaderboard?page=0@(levelQuery)&player=@entry.PlayerName">@entry.PlayerName</a>
                        </strong>
                    </td>
                    <td><strong>@entry.TotalScore</strong></td>
                    <td><strong>@entry.LatestSubmission.ToLocalTime()</strong></td>
                    
                </tr>
            }
            else
            {
                <tr>
                    <td>@entry.Rank</td>
                    <td>
                        <a href="/Leaderboard?page=0@(levelQuery)&player=@entry.PlayerName">@entry.PlayerName</a>
                    </td>
                    <td>@entry.TotalScore</td>
                    <td>@entry.LatestSubmission.ToLocalTime()</td>
                </tr>
            }
        }
    </tbody>
</table>

@{
    
}
<div style="margin-top: 20px;">
    @if (Model.CurrentPage > 1)
    {
        <a href="/Leaderboard?page=@(Model.CurrentPage - 1)@levelQuery@playerQuery" class="btn btn-primary">← Previous</a>
    }
    else
    {
        <button class="btn btn-secondary disabled">← Previous</button>
    }

    @if (Model.Scores.Count == 10)
    {
        <a href="/Leaderboard?page=@(Model.CurrentPage + 1)@levelQuery@playerQuery"
           class="btn btn-primary" style="margin-left: 10px;">
            Next →
        </a>
    }
    else
    {
        <button class="btn btn-secondary disabled" style="margin-left: 10px;">Next →</button>
    }
</div>
